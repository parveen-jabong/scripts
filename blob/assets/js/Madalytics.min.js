/* eslint-disable */
/* jshint ignore:start */
var Madalytics=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&i(e.prototype,t)}(e,[{key:"init",value:function(){}},{key:"get",value:function(){}},{key:"put",value:function(){}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),u=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={url:"https://madalytics-qa.myntra.com/track-web",storage:"indexedDB",batchMaxDuration:0,batchMaxSize:20,maxQueueSize:50,maxRetryCount:3,domain:".myntra.com",debug:!0},this.pageContext={},this.pageDataSet={},this.documentLocation={},this.pageTitle="",this.send=this.send.bind(this),this._sendNextSet=this._sendNextSet.bind(this)}return function(e,t,n){t&&o(e.prototype,t)}(e,[{key:"configure",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.debug||e.url||(e.url="https://touch.myntra.com/track-web"),this.config=r({},this.config,e),this.storage=(0,a.default)(this.config.storage),this._init(t,n),this._startTimer()}},{key:"setDocumentLocation",value:function(e){this.documentLocation=e}},{key:"setPageTitle",value:function(e){this.pageTitle=e}},{key:"_setRequestQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.requestQueue=e}},{key:"_setProcessingQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.processingQueue=e,this.processingQueue.length>0&&this._sendToServer(this.processingQueue)}},{key:"_init",value:function(e,t){this.initialized||(this.setGlobalContext(e),this.storage=(0,a.default)(this.config.storage),this._setRequestQueue(),this._setProcessingQueue(),this.storage.get("rQ",this.requestQueue),this.storage.get("pQ",this.processingQueue),this.initialized=!0)}},{key:"_addToRequestQueue",value:function(e){var t;(t=this.requestQueue).push.apply(t,i(e)),this.requestQueue=this.requestQueue.slice(0,this.config.maxQueueSize),this.storage.put("rQ",this.requestQueue)}},{key:"_addToProcessingQueue",value:function(e){var t;(t=this.processingQueue).push.apply(t,i(e)),this.retryCount=0,this.storage.put("pQ",this.processingQueue)}},{key:"setGlobalContext",value:function(e){this.globalContext=r(this.globalContext||{},e),this.storage.put("gc",this.globalContext)}},{key:"getGlobalContext",value:function(){return this.globalContext}},{key:"setPageContext",value:function(e){this.pageContext=r({},this.pageContext,e)}},{key:"getPageContext",value:function(){return this.pageContext}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._enhanceEvent({type:e,params:t},n);this.config.batchMaxDuration<=0?this._sendToServer([i]):this._addToRequestQueue([i])}},{key:"_getPageDS",value:function(){return this.pageDataSet}},{key:"_setPageDS",value:function(e){this.pageDataSet=e,this.storage.put("pageDS",e)}},{key:"_getPrevRef",value:function(){return{prev_screen_entity_name:this.pageDataSet.entity_name,prev_screen_name:this.pageDataSet.name,prev_screen_type:this.pageDataSet.entity_type,prev_screen_entity_type:this.pageDataSet.entity_type,prev_screen_url:this.pageDataSet.url}}},{key:"_enhanceEvent",value:function(e,t){var n=this._getPrevRef();return this._setPageDS(this._getPageDS()),e.params=r(this.globalContext,{payload:r(t,{screen:r({referer:n},this.pageDataSet,this.pageContext,e.params)})}),this.config.debug&&(e.params._ts="LoadTest"),e.params._t=e.type,e.params.time_stamp=(new Date).getTime(),e}},{key:"_sendToServer",value:function(e){var t=this,n=new XMLHttpRequest;clearInterval(this._timer),this.retryCount++,n.withCredentials=!0,n.open("POST",this.config.url),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.setRequestHeader("Accept","application/json"),n.send(JSON.stringify(e.map(function(e){return e.params}))),n.onreadystatechange=function(){4!==n.readyState||200!==n.status&&0!==n.status?4===n.readyState&&(t.config.storage&&t.retryCount<t.config.maxRetryCount?t._retryProcessingQueue():t._clearProcessingQueue()):t.config.storage&&(t._clearProcessingQueue(e),t._startTimer())}}},{key:"_clearProcessingQueue",value:function(){this.processingQueue=[],this._addToProcessingQueue([])}},{key:"_retryProcessingQueue",value:function(){this._sendToServer(this.processingQueue)}},{key:"_sendNextSet",value:function(){this.processingQueue=[],this._addToProcessingQueue(this.requestQueue.splice(0,this.config.batchMaxSize)),this.processingQueue.length>0&&this._sendToServer(this.processingQueue)}},{key:"_startTimer",value:function(){clearInterval(this._timer),this.config.batchMaxDuration>0&&(this._timer=setInterval(this._sendNextSet,this.config.batchMaxDuration))}},{key:"_cleanGlobalContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.email!==this.globalContext.user.email||this.globalContext.user.email&&!e.email}}]),e}());t.default=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(3)),o=i(n(0));t.default=function(e){switch(e){case"indexedDB":return new r.default;default:return new o.default}}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a="_madalytics",u=1,s="data",c=function(e){function t(){var e;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),e.db=null,indexedDB||"undefined"!=typeof window&&"indexedDB"in window){var n=indexedDB.open(a,u);n.onupgradeneeded=function(t){e.db=n.result,e.db.objectStoreNames.contains(s)||e.db.createObjectStore(s,{keyPath:"key"})},n.onsuccess=function(t){e.db=n.result}}return e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,n){t&&r(e.prototype,t)}(t,[{key:"put",value:function(e,t,n){this.db&&this.db.transaction([s],"readwrite").objectStore(s).put({key:e,val:t})}},{key:"get",value:function(e,t){if(this.db){var n=this.db.transaction([s],"readwrite").objectStore(s).get(e);n.onsuccess=function(){t(n.result.val)}}}}]),t}();t.default=c}]);
